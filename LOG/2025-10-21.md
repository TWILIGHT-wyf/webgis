### 1.严格TypeScript配置：

```ts
{
  "files": [],
  "references": [
    {
      "path": "./tsconfig.node.json"
    },
    {
      "path": "./tsconfig.app.json"
    },
    {
      "path": "./tsconfig.vitest.json"
    }
  ],
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "exactOptionalPropertyTypes": true,
    "noUncheckedIndexedAccess": true,
    "noFallthroughCasesInSwitch": true,
    "useDefineForClassFields": true,
    "forceConsistentCasingInFileNames": true
  }
}
```

### 2.扩展vue-router的meta类型

```ts
declare module 'vue-router' {
  interface RouteMeta {
    title?: string                // 路由页面标题（可选）
    requiresAuth?: boolean        // 是否需要登录鉴权（可选）
    roles?: string[]              // 允许访问的用户角色列表（可选）
    keepAlive?: boolean           // 是否缓存该页面（可选，常用于 <keep-alive>）
  }
}
```

### 3.登录实现

#### 1.流程：

1. 表单验证
2. 调用登录 API（POST）
3. 后端返回 token 与用户信息
4. 在 Pinia 中保存 user/token 并持久化（localStorage 或 cookie）
5. 配置 HTTP 客户端（Axios）在请求头附带 token
6. 路由守卫根据 token/roles 控制页面访问
7. 处理 token 过期：提示/刷新/登出
8. 刷新页面时从持久化恢复状态（rehydrate）

#### 2.类型扩展：

- User
- Payload
- Response

### 4.Mock

#### 1.常用mock工具：

- **MSW (Mock Service Worker)**：推荐。拦截浏览器请求，支持 TypeScript，易集成测试。
- **json-server**：简单 REST API Mock，基于 JSON 文件。
- **Mirage.js**：功能强大，支持路由、数据关系。
- **vite-plugin-mock**

#### 2.Vite-plugin-mock

##### 1.安装

```
npm install vite-plugin-mock -D
```

##### 2.配置vite.config.js

```ts
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import { viteMockServe } from 'vite-plugin-mock';
import path from 'path';
export default defineConfig({
	plugins: [
		vue(),
		viteMockServe({
			mockPath: "mock", // mock数据存放的文件夹
			localEnabled: true, // 是否在开发环境下启用 mock
		}),
	],
	resolve:{
		alias:{
			'@': path.resolve(__dirname,'./src'),
		}
	},
});
```

- `mockPath`: 用于配置 mock 数据文件存放的文件夹路径
- `localEnabled`: 是否在开发环境下开启 mock 服务
- 需要在`vite.config.js` 中配置`resolve.alias`别名，用于后续导入路径。

##### 3.创建mock文件夹

在根目录创建mock

##### 4.创建mock文件

#### 3.MSW（Mock Service Worker）

MSW 当前最新稳定版本：2.11.6（v2 系列）。

MSW v2 关键变化：

- 废弃 rest API，统一使用 http（如 http.get/http.post）。
- 不再使用 res/ctx 组合响应，直接 return HttpResponse.json()/HttpResponse.text() 等。
- 浏览器端的 setupWorker 改为从 'msw/browser' 导入。
- Node 测试端依然从 'msw/node' 导入 setupServer。
- 仅作为类型使用的符号用 import type 导入，避免运行时导出错误。

##### 1.安装

```
npm install msw --save-dev
```

##### 2.初始化

运行以下命令生成 Service Worker 文件：

```
npx msw init public/ --save
```

这会在 `public`下生成 `mockServiceWorker.js`。

##### 3.创建Mock处理器（v2 写法）

```ts
import { http, HttpResponse } from 'msw'
// import type { YourType } from '...' // 仅类型用 import type

export const handlers = [
	// POST /api/auth/login
	http.post('/api/auth/login', async ({ request }) => {
		const { username, password } = await request.json()
		if (username === 'admin' && password === '123456') {
			const response = {
				accessToken: 'mock-access-token',
				refreshToken: 'mock-refresh-token',
				user: mockUser,
			}
			return HttpResponse.json(response, { status: 200 })
		}
		return HttpResponse.json({ message: 'Invalid credentials' }, { status: 401 })
	}),

	// GET /api/users
	http.get('/api/users', () => {
		return HttpResponse.json([mockUser], { status: 200 })
	}),

	// 模拟延迟/错误
	http.get('/api/slow-api', async () => {
		await new Promise((resolve) => setTimeout(resolve, 2000)) // 2秒延迟
		return HttpResponse.json({ data: 'slow response' }, { status: 200 })
	}),
]
```

##### 4.设置服务器

**创建文件**：`src/mock/server.ts`（Node.js 环境，如 Vitest）

```ts
import { setupServer } from 'msw/node'
import { handlers } from './handlers'
export const server = setupServer(...handlers)
```

##### 5.设置浏览器Worker(开发环境)

**创建文件**：`src/mock/browser.ts`

```ts
import { setupWorker } from 'msw/browser'
import { handlers } from './handlers'
export const worker = setupWorker(...handlers)
```

##### 6.启用MSW

开发环境`main.ts`

```ts
// 仅开发时启用
if (import.meta.env.DEV) {
  const { worker } = await import('./mock/browser')
  worker.start({
    onUnhandledRequest: 'bypass',  // 未处理的请求不报错
  })

}
```

测试环境（`src/setupTests.ts` 或 Vitest 配置）

```ts
import { beforeAll, afterEach, afterAll } from 'vitest'
import { server } from './mocks/server'
beforeAll(() => server.listen())
afterEach(() => server.resetHandlers())  // 重置处理器
afterAll(() => server.close())
```
